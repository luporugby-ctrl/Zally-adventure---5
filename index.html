<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zally's Gem Quest - Arcade Edition</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts: Press Start 2P for Retro Feel -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">

    <!-- Tailwind Config for Zalando Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        zalando: {
                            DEFAULT: '#FF6900', // Zalando Orange
                            dark: '#D15600',
                            light: '#FF8533'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Retro Font Settings */
        .font-arcade { font-family: 'Press Start 2P', cursive; }
        .font-term { font-family: 'VT323', monospace; }

        /* CRT Monitor Effects */
        body {
            background-color: #111;
            color: #eee;
            overflow-x: hidden;
        }

        .crt-container {
            background: radial-gradient(circle, #2a2a2a 0%, #000 100%);
            min-height: 100vh;
            position: relative;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.9);
            border: 20px solid #1a1a1a;
            border-radius: 20px;
        }

        /* Scanlines */
        .scanlines {
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.2) 50%,
                rgba(0,0,0,0.2)
            );
            background-size: 100% 4px;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 10;
        }

        /* UI Elements */
        .ui-layer {
            position: relative;
            z-index: 50;
        }

        /* Text Effects */
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .glitch-text {
            animation: glitch 1s linear infinite;
            color: red;
            text-shadow: 2px 2px #00f;
        }
        @keyframes glitch {
            2%, 64% { transform: translate(2px,0) skew(0deg); }
            4%, 60% { transform: translate(-2px,0) skew(0deg); }
            62% { transform: translate(0,0) skew(5deg); }
        }

        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* Pixelated Image Rendering */
        .pixelated {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        /* Chart Container for responsiveness */
        .chart-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #FF6900; border: 1px solid #FF6900; }
    </style>
</head>
<body class="crt-container flex flex-col items-center justify-center p-4">

    <!-- Scanline Overlay -->
    <div class="scanlines"></div>

    <!-- UI: Header / Marquee -->
    <header class="ui-layer w-full max-w-4xl flex justify-between items-end border-b-4 border-zalando pb-4 mb-6 relative">
        <div class="text-left">
            <h2 class="font-arcade text-yellow-400 text-xs md:text-sm mb-1">SCORE: <span id="score">00000</span></h2>
            <h1 class="font-arcade text-zalando text-lg md:text-2xl tracking-tighter shadow-orange-glow">ZALLY'S GEM QUEST</h1>
        </div>
        <div class="text-right">
            <div class="font-arcade text-cyan-400 text-xs md:text-sm animate-pulse">CREDITS: ADMIN MODE</div>
        </div>
    </header>

    <!-- UI: Main Game Screen -->
    <main id="game-screen" class="ui-layer w-full max-w-4xl bg-black border-4 border-gray-700 p-4 md:p-8 relative min-h-[600px] flex flex-col shadow-2xl">
        
        <!-- STATE 1: START SCREEN -->
        <div id="start-view" class="flex-1 flex flex-col items-center justify-center text-center space-y-8">
            <img src="zally-warrior.png" alt="Zally" class="w-32 h-32 md:w-48 md:h-48 object-contain mb-4 pixelated animate-bounce" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
            <div class="text-6xl md:text-8xl mb-4 hidden">üëæ</div>

            <h1 class="font-arcade text-4xl md:text-5xl text-white mb-2 leading-tight">GEM<br><span class="text-zalando">HEROES</span></h1>
            
            <p class="font-term text-xl text-green-400 max-w-lg">
                Zally needs help to navigate the Operational Chaos.<br>
                Unlock the power of <span class="text-white font-bold">GEMS</span> to save the day!
            </p>

            <button onclick="startGame()" class="mt-8 px-8 py-4 bg-zalando hover:bg-zalando-light text-black font-arcade text-sm md:text-xl border-b-4 border-zalando-dark active:border-b-0 active:translate-y-1 transition-all blink font-bold cursor-pointer z-50">
                INSERT COIN / START
            </button>
        </div>

        <!-- STATE 1.5: GEM TUTORIAL (NEW) -->
        <div id="tutorial-view" class="hidden flex-1 flex flex-col">
            <h2 class="font-arcade text-center text-zalando mb-6 text-sm md:text-lg border-b-2 border-zalando pb-2">LEVEL 0: THE GEM ACADEMY</h2>
            
            <div class="flex-1 overflow-y-auto space-y-6 pr-2">
                <!-- Concept Card -->
                <div class="bg-gray-900 border border-green-500 p-4 shadow-lg">
                    <h3 class="font-arcade text-green-400 text-sm mb-2">1. WHAT IS A GEM?</h3>
                    <div class="flex gap-4">
                        <div class="text-3xl">üé≠</div>
                        <p class="font-term text-lg text-gray-300">
                            Think of a Gem as a <span class="text-white">custom mask</span> for Gemini. <br>
                            Standard Gemini is a generalist (knows a bit of everything). 
                            A <strong>Gem</strong> has a specific role, a tone of voice, and specific knowledge files. It never forgets its instructions.
                        </p>
                    </div>
                </div>

                <!-- Creation Card -->
                <div class="bg-gray-900 border border-cyan-500 p-4 shadow-lg">
                    <h3 class="font-arcade text-cyan-400 text-sm mb-2">2. HOW TO CREATE ONE</h3>
                    <div class="font-term text-lg text-gray-300">
                        <ol class="list-decimal list-inside space-y-1">
                            <li>Go to <strong>Gem Manager</strong>.</li>
                            <li>Click <span class="text-white">"New Gem"</span>.</li>
                            <li><strong>Write Instructions:</strong> This is crucial! Tell it exactly how to behave (e.g., "Act as a Strict Editor").</li>
                            <li><strong>Add Knowledge:</strong> Upload PDFs or Docs (SOPs, Guidelines) for it to reference.</li>
                        </ol>
                    </div>
                </div>

                <!-- Why Card -->
                <div class="bg-gray-900 border border-purple-500 p-4 shadow-lg">
                    <h3 class="font-arcade text-purple-400 text-sm mb-2">3. WHY USE THEM?</h3>
                    <div class="flex gap-4">
                        <div class="text-3xl">‚ö°</div>
                        <p class="font-term text-lg text-gray-300">
                            <strong>Save Time:</strong> Don't repeat context every time.<br>
                            <strong>Consistency:</strong> It always responds in the format/style you need.<br>
                            <em>Example: "The Meeting Summarizer" always gives you a To-Do list.</em>
                        </p>
                    </div>
                </div>
            </div>

            <div class="mt-6 text-center">
                <button onclick="enterSelection()" class="px-6 py-3 bg-green-600 hover:bg-green-500 text-white font-arcade text-sm border-b-4 border-green-800 active:border-b-0 active:translate-y-1 transition-all cursor-pointer">
                    I'M READY TO CHOOSE MY HERO >>
                </button>
            </div>
        </div>

        <!-- STATE 2: CHARACTER SELECT -->
        <div id="select-view" class="hidden flex-1 flex flex-col">
            <h2 class="font-arcade text-center text-white mb-6 text-sm md:text-lg">SELECT YOUR GEM HERO</h2>
            
            <div class="flex flex-col md:flex-row gap-6 flex-1">
                <!-- Left: Hero Grid -->
                <div class="md:w-1/2 grid grid-cols-2 gap-4 content-start">
                    <!-- Hero 1: The Executor -->
                    <button onclick="selectHero('warrior')" onmouseenter="previewHero('warrior')" class="hero-btn group border-4 border-gray-600 hover:border-yellow-400 p-4 bg-gray-900 focus:outline-none focus:border-yellow-400 transition-colors cursor-pointer">
                        <img src="warrior.png" alt="Warrior" class="w-10 h-10 md:w-12 md:h-12 mb-2 mx-auto object-contain group-hover:scale-110 transition-transform pixelated" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                        <div class="text-4xl mb-2 text-center hidden">‚öîÔ∏è</div>
                        <div class="font-arcade text-xs text-center text-gray-400 group-hover:text-yellow-400">THE EXECUTOR</div>
                    </button>
                    <!-- Hero 2: Valkyrie (NOW PROCESS ALLY) -->
                    <button onclick="selectHero('valkyrie')" onmouseenter="previewHero('valkyrie')" class="hero-btn group border-4 border-gray-600 hover:border-cyan-400 p-4 bg-gray-900 focus:outline-none focus:border-cyan-400 transition-colors cursor-pointer">
                        <img src="valchiria.png" alt="Valkyrie" class="w-10 h-10 md:w-12 md:h-12 mb-2 mx-auto object-contain group-hover:scale-110 transition-transform pixelated" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                        <div class="text-4xl mb-2 text-center hidden">üõ°Ô∏è</div>
                        <div class="font-arcade text-xs text-center text-gray-400 group-hover:text-cyan-400">PROCESS ALLY</div>
                    </button>
                    <!-- Hero 3: Wizard -->
                    <button onclick="selectHero('wizard')" onmouseenter="previewHero('wizard')" class="hero-btn group border-4 border-gray-600 hover:border-purple-400 p-4 bg-gray-900 focus:outline-none focus:border-purple-400 transition-colors cursor-pointer">
                        <img src="wizard.png" alt="Wizard" class="w-10 h-10 md:w-12 md:h-12 mb-2 mx-auto object-contain group-hover:scale-110 transition-transform pixelated" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                        <div class="text-4xl mb-2 text-center hidden">üßô‚Äç‚ôÇÔ∏è</div>
                        <div class="font-arcade text-xs text-center text-gray-400 group-hover:text-purple-400">WIZARD</div>
                    </button>
                    <!-- Hero 4: Elf -->
                    <button onclick="selectHero('elf')" onmouseenter="previewHero('elf')" class="hero-btn group border-4 border-gray-600 hover:border-green-400 p-4 bg-gray-900 focus:outline-none focus:border-green-400 transition-colors cursor-pointer">
                        <img src="elf.png" alt="Elf" class="w-10 h-10 md:w-12 md:h-12 mb-2 mx-auto object-contain group-hover:scale-110 transition-transform pixelated" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                        <div class="text-4xl mb-2 text-center hidden">üßù</div>
                        <div class="font-arcade text-xs text-center text-gray-400 group-hover:text-green-400">ELF</div>
                    </button>
                    <!-- 5th Slot -->
                    <button id="slot-5" onclick="triggerBoss()" class="col-span-2 border-4 border-red-500 bg-red-900 p-4 animate-pulse cursor-pointer hover:bg-red-800 transition-colors">
                        <div class="text-red-200 font-arcade text-xs text-center blink">‚ö†Ô∏è BOSS LEVEL ‚ö†Ô∏è<br>(CLICK TO PLAY)</div>
                    </button>
                </div>

                <!-- Right: Stats & Details -->
                <div class="md:w-1/2 bg-gray-900 border-2 border-zalando p-4 flex flex-col">
                    <div id="hero-display-name" class="font-arcade text-xl text-yellow-400 mb-2 border-b border-gray-700 pb-2">CHOOSE HERO</div>
                    
                    <div class="flex flex-row h-40 mb-4 gap-2">
                        <div id="hero-image-container" class="w-1/2 border-2 border-gray-700 bg-black relative overflow-hidden flex justify-center items-center">
                            <div class="absolute inset-0 opacity-20 pointer-events-none" style="background-image: radial-gradient(circle, #333 1px, transparent 1px); background-size: 10px 10px;"></div>
                            <img id="hero-large-img" src="" alt="Hero" class="h-full object-contain hidden pixelated z-10">
                            <div id="hero-placeholder-text" class="font-arcade text-gray-600 text-[10px] text-center p-2 z-10 animate-pulse">
                                HOVER HERO
                            </div>
                        </div>
                        <div class="w-1/2 chart-container relative border-2 border-gray-700 bg-black">
                            <canvas id="heroRadarChart"></canvas>
                        </div>
                    </div>

                    <div class="flex-1 overflow-y-auto font-term text-lg leading-tight text-white">
                        <p id="hero-desc">Hover over a hero to see details.</p>
                        <div id="hero-special" class="mt-4 text-white font-bold hidden">
                            GEM USE CASE: <span id="special-text" class="text-cyan-300"></span>
                        </div>
                    </div>

                    <button id="select-btn" class="mt-4 w-full bg-gray-700 text-gray-500 font-arcade py-3 cursor-not-allowed" disabled>
                        SELECT HERO ABOVE
                    </button>
                </div>
            </div>
        </div>

        <!-- STATE 3: SCENARIO / BATTLE -->
        <div id="battle-view" class="hidden flex-1 flex flex-col justify-between">
            <div class="flex-1 bg-gray-900 border-b-4 border-white mb-4 relative overflow-hidden p-6 flex flex-col items-center justify-center">
                <div class="absolute top-4 left-4 font-arcade text-red-500 text-xs blink">WARNING: ERROR DETECTED</div>
                
                <div class="flex items-center gap-8 mb-8">
                    <div class="text-center">
                        <img src="zally-warrior.png" alt="Zally" class="w-24 h-24 md:w-32 md:h-32 object-contain animate-bounce pixelated mx-auto" onerror="this.src='https://ui-avatars.com/api/?name=Zally&background=FF6900&color=000&size=128&bold=true'"> 
                        <div class="font-arcade text-xs mt-2 text-white">ZALLY</div>
                    </div>
                    <div class="font-arcade text-xl text-red-500">VS</div>
                    <div class="text-center">
                        <div id="monster-icon" class="text-6xl md:text-8xl">üìÑ</div>
                        <div id="monster-name" class="font-arcade text-xs mt-2 text-red-400">BLANK PAGE</div>
                    </div>
                </div>

                <div id="hero-action-container" class="hidden text-center transform transition-all duration-500 scale-0 absolute bottom-10 bg-black/80 p-4 border-2 border-zalando rounded">
                    <div id="battle-hero-icon" class="mb-2 flex justify-center"></div>
                    <div id="battle-move-name" class="font-arcade text-zalando text-lg md:text-xl">INSTANT DRAFT!</div>
                </div>
            </div>

            <div class="h-32 bg-blue-900 border-4 border-white p-4 font-term text-xl text-white overflow-hidden">
                <p id="battle-log"></p>
                <div id="battle-cursor" class="inline-block w-2 h-5 bg-white blink align-bottom"></div>
            </div>

            <button onclick="returnToSelect()" id="next-btn" class="hidden mt-4 self-end text-yellow-400 font-arcade text-xs blink hover:text-white cursor-pointer z-50">
                CONTINUE ‚ñ∂
            </button>
        </div>

        <!-- STATE 4: BOSS BATTLE (GLITCH) -->
        <div id="boss-view" class="hidden flex-1 flex flex-col items-center justify-center bg-black relative overflow-hidden">
            <div class="absolute inset-0 bg-red-900 opacity-20 animate-pulse"></div>
            <h2 class="font-arcade text-red-500 text-center text-xl md:text-3xl mb-8 glitch-text">‚ö†Ô∏è WARNING: NEW CHALLENGER ‚ö†Ô∏è</h2>
            
            <img src="monster.png" alt="Boss" class="w-48 h-48 md:w-64 md:h-64 object-contain mb-8 shake pixelated" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
            <div class="text-8xl md:text-9xl mb-8 shake hidden">üëæ</div>

            <h3 class="font-arcade text-white text-lg mb-4">OPS UNFORESEEN</h3>
            <div class="font-term text-red-300 text-xl text-center max-w-md mb-8 space-y-2">
                <p>Analyzing Warrior... <span class="text-red-600">K.O.</span></p>
                <p>Analyzing Process Ally... <span class="text-red-600">K.O.</span></p>
                <p>Analyzing Wizard... <span class="text-red-600">K.O.</span></p>
                <p>Analyzing Elf... <span class="text-red-600">K.O.</span></p>
                <p class="blink mt-4">PRESETS FAILED!</p>
            </div>
            <button onclick="unlockCustom()" class="px-6 py-3 border-2 border-red-500 text-red-500 font-arcade hover:bg-red-900 hover:text-white transition-colors cursor-pointer z-50">
                SEARCHING SOLUTION...
            </button>
        </div>

        <!-- STATE 5: CUSTOM HERO (VICTORY) -->
        <div id="custom-view" class="hidden flex-1 flex flex-col items-center justify-center text-center">
            <div class="text-zalando text-6xl mb-4 animate-spin-slow">‚ú®</div>
            <h1 class="font-arcade text-3xl md:text-4xl text-white mb-4">UNLOCK NEW HERO</h1>
            <div class="bg-gray-800 p-6 border-4 border-zalando max-w-lg mb-8">
                <h3 class="font-arcade text-green-400 mb-2">CLASS: CUSTOM CREATOR</h3>
                <p class="font-term text-xl text-gray-300 mb-4">
                    No Preset knows your work like you do.<br>
                    Create your hero. Train them on your unique challenges.<br>
                    Bard? Merchant? Paladin?<br>
                    <span class="text-white font-bold">The possibilities are INFINITE.</span>
                </p>
            </div>
            <a href="https://gemini.google.com/" target="_blank" class="block w-full max-w-md mx-auto relative z-50">
                <div class="bg-zalando hover:bg-zalando-light text-black font-arcade py-6 px-4 border-b-8 border-zalando-dark active:border-b-0 active:translate-y-2 transition-all shadow-lg text-lg md:text-xl blink font-bold">
                    üëâ INSERT COIN TO CREATE GEM
                </div>
            </a>
            <p class="mt-4 font-term text-gray-500">Press to start your custom adventure</p>
            <button onclick="resetGame()" class="mt-12 text-xs font-arcade text-gray-600 hover:text-white cursor-pointer z-50">
                RESET SYSTEM
            </button>
        </div>
    </main>

    <div class="mt-8 text-gray-600 font-arcade text-xs text-center">
        ZALANDO OPERATIONS - ARCADE DIVISION 198X
    </div>

    <!-- Game Logic -->
    <script>
        // --- DATA ---
        const heroes = {
            warrior: {
                name: "THE EXECUTOR",
                role: "TICKET RESOLUTION",
                icon: "warrior.png", 
                desc: "This Support Gem acts as an expert for your specific processes. Upload a Jira ticket screenshot and your SOPs to get an exact step-by-step resolution.",
                stats: [90, 40, 80, 20],
                color: "rgba(255, 206, 86, 0.6)",
                monsterName: "THE BLOCKED TICKET",
                monsterIcon: "üé´",
                move: "SOP STRIKE",
                log: "The Executor analyzes the ticket image. Cross-references with the Process SOP. Output: 'Escalate to Level 2'. Problem solved!"
            },
            valkyrie: {
                name: "THE PROCESS ALLY",
                role: "CONTINUOUS IMPROVEMENT",
                icon: "valchiria.png", 
                desc: "The ultimate sidekick for Process Captains. This Shared Gem scans current workflows to spot gaps, suggest smarter shortcuts, and drive Continuous Improvement.",
                stats: [50, 60, 90, 70], // Increased Tech/Soft stats slightly for "improvement" logic
                color: "rgba(75, 192, 192, 0.6)",
                monsterName: "THE BOTTLENECK",
                monsterIcon: "üêå",
                move: "OPTIMIZATION BEAM",
                log: "Process Captain Ally reviews the workflow and spots a manual step slowing us down. With the support of the Shared Gem (Super Expert), it resolves the bottleneck!"
            },
            wizard: {
                name: "EXCEL COACH",
                role: "SKILL BOOSTER",
                icon: "wizard.png", 
                desc: "This Data Gem doesn't just give you the result, it teaches you. Upload your Excel file and it explains the formulas, helps you read the data, and boosts your tech skills.",
                stats: [30, 100, 80, 20],
                color: "rgba(153, 102, 255, 0.6)",
                monsterName: "THE CONFUSING REPORT",
                monsterIcon: "üìä",
                move: "KNOWLEDGE TRANSFER",
                log: "The Wizard analyzes the file. Explains the Pivot logic and teaches you a better formula. Skill Up complete!"
            },
            elf: {
                name: "THE MENTOR",
                role: "ROLEPLAY COACH",
                icon: "elf.png", 
                desc: "This Coaching Gem simulates the conversation with you (Roleplay) to help you find the right words. Perfect for tough feedback or interview prep.",
                stats: [40, 20, 50, 100],
                color: "rgba(74, 222, 128, 0.6)",
                monsterName: "SPEAKER'S BLOCK",
                monsterIcon: "üí¨",
                move: "CONFIDENCE BOOST",
                log: "The Elf simulates the dreaded question. Suggests a structured answer. You are ready!"
            }
        };

        // --- STATE ---
        let currentHeroKey = null;
        let radarChart = null;
        let bossUnlocked = true; 
        let scenariosPlayed = 0;

        // --- CHART SETUP ---
        function initChart() {
            const ctx = document.getElementById('heroRadarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Exec', 'Tech', 'Std', 'Soft'],
                    datasets: [{
                        label: 'Stats',
                        data: [0, 0, 0, 0],
                        backgroundColor: 'rgba(255, 105, 0, 0.5)', 
                        borderColor: '#FF6900',
                        borderWidth: 1,
                        pointRadius: 1,
                        pointBackgroundColor: '#fff'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    responsive: true,
                    scales: {
                        r: {
                            angleLines: { color: '#333' },
                            grid: { color: '#333' },
                            pointLabels: {
                                color: '#aaa',
                                font: { family: "'Press Start 2P'", size: 8 }
                            },
                            ticks: { display: false, max: 100, min: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    },
                    animation: { duration: 500 }
                }
            });
        }

        // --- NAVIGATION LOGIC ---
        function showScreen(screenId) {
            document.querySelectorAll('main > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
        }

        function startGame() {
            // New Flow: Start -> Tutorial
            showScreen('tutorial-view');
        }

        function enterSelection() {
            // New Flow: Tutorial -> Select
            showScreen('select-view');
            // Chart needs to be initialized/resized here because it was hidden
            setTimeout(() => {
                if (!radarChart) {
                    initChart();
                } else {
                    radarChart.resize();
                    radarChart.update();
                }
            }, 100);
        }

        function previewHero(heroKey) {
            const hero = heroes[heroKey];
            if (!hero) return;

            document.getElementById('hero-display-name').innerText = hero.name;
            document.getElementById('hero-display-name').style.color = hero.color.replace('0.6', '1');
            document.getElementById('hero-desc').innerText = hero.desc;
            document.getElementById('hero-special').classList.remove('hidden');
            document.getElementById('special-text').innerText = hero.role;

            const bigImg = document.getElementById('hero-large-img');
            const placeholder = document.getElementById('hero-placeholder-text');

            if (hero.icon.includes('.')) {
                bigImg.src = hero.icon;
                bigImg.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                bigImg.classList.add('hidden');
                placeholder.classList.remove('hidden');
                placeholder.innerText = hero.icon; 
            }

            if(radarChart) {
                radarChart.data.datasets[0].data = hero.stats;
                radarChart.data.datasets[0].backgroundColor = hero.color;
                radarChart.data.datasets[0].borderColor = hero.color.replace('0.6', '1');
                radarChart.update();
            }
        }

        function selectHero(heroKey) {
            currentHeroKey = heroKey;
            previewHero(heroKey); 
            
            const btn = document.getElementById('select-btn');
            btn.disabled = false;
            btn.classList.remove('cursor-not-allowed', 'bg-gray-700', 'text-gray-500');
            btn.classList.add('bg-zalando', 'text-black', 'hover:bg-zalando-light', 'blink');
            btn.innerText = "PLAY " + heroes[heroKey].name;
            btn.onclick = () => runScenario(heroKey);
        }

        function runScenario(heroKey) {
            const hero = heroes[heroKey];
            showScreen('battle-view');

            document.getElementById('battle-log').innerText = "";
            document.getElementById('monster-icon').innerText = hero.monsterIcon;
            document.getElementById('monster-name').innerText = hero.monsterName;
            
            const actionContainer = document.getElementById('hero-action-container');
            actionContainer.classList.add('hidden');
            actionContainer.classList.remove('scale-100');
            actionContainer.classList.add('scale-0');
            
            document.getElementById('next-btn').classList.add('hidden');

            typeWriter(`Zally is in trouble! ${hero.monsterName} attacks!`, 'battle-log', () => {
                setTimeout(() => {
                    const iconEl = document.getElementById('battle-hero-icon');
                    if (hero.icon.includes('.')) {
                        iconEl.innerHTML = `<img src="${hero.icon}" class="w-20 h-20 md:w-24 md:h-24 object-contain mx-auto pixelated animate-bounce">`;
                        iconEl.className = "mb-2 flex justify-center";
                    } else {
                        iconEl.innerText = hero.icon;
                        iconEl.className = "text-6xl mb-2 flex justify-center";
                    }

                    document.getElementById('battle-move-name').innerText = hero.move;
                    actionContainer.classList.remove('hidden');
                    
                    setTimeout(() => {
                        actionContainer.classList.remove('scale-0');
                        actionContainer.classList.add('scale-100');
                    }, 100);

                    const actionText = `\nPLAYER ENTERED!\n${hero.log}`;
                    typeWriter(actionText, 'battle-log', () => {
                        scenariosPlayed++;
                        checkBossUnlock();
                        document.getElementById('next-btn').classList.remove('hidden');
                    });

                }, 1000);
            });
        }

        function typeWriter(text, elementId, callback) {
            const element = document.getElementById(elementId);
            let i = 0;
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, 30);
                } else if (callback) {
                    callback();
                }
            }
            type();
        }

        function returnToSelect() {
            showScreen('select-view');
            const btn = document.getElementById('select-btn');
            btn.disabled = true;
            btn.classList.add('cursor-not-allowed', 'bg-gray-700', 'text-gray-500');
            btn.classList.remove('bg-zalando', 'text-black', 'hover:bg-zalando-light', 'blink');
            btn.innerText = "SELECT HERO ABOVE";
        }

        function checkBossUnlock() {
            if (scenariosPlayed >= 1) {
                document.getElementById('score').innerText = "15000";
            }
        }

        function triggerBoss() {
            showScreen('boss-view');
        }

        function unlockCustom() {
            showScreen('custom-view');
        }

        function resetGame() {
            location.reload();
        }
    </script>
</body>
</html>
